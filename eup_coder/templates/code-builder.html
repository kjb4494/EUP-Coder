{% extends 'base.html' %}
{% load static%}

{% block css %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/datatables.min.css' %}"/>
  <style>
    .increase-arrow{
      cursor: pointer;
    }
  </style>
{% endblock css %}

{% block sidebar-content %}
  <h3 style="text-align: center; padding: 10px; cursor: pointer; color: #003366">
    <span onclick="CopyToClipboard('result-code')">Click here to result copy!</span>
  </h3>
  <div class="main-card mb-3 card" style="margin: 20px">
    <div class="card-body" id="result-code">
      modified_code = {<br>
        {% for code in code_generator %}
          &nbsp;&nbsp;&nbsp;&nbsp;{{ code.codename }} = {{ code.value }}<br>
        {% endfor %}
      }
    </div>
  </div>
{% endblock sidebar-content %}

{% block page-title %}
  <div class="page-title-icon">
    <i class="fa fa-hammer icon-gradient bg-arielle-smile"></i>
  </div>
  <div>Code Builder</div>
{% endblock page-title %}

{% block page-title-actions %}
  <button class="btn-shadow mr-3 btn btn-success" onclick="location.href='{% url 'code-builder' %}'">빌드하기</button>
  <button class="btn-shadow mr-3 btn btn-dark" onclick="location.href='{% url 'refresh-cache' %}'">초기화</button>
{% endblock page-title-actions %}

{% block page-content %}
  <div class="main-card mb-3 card">
    <div class="card-body">
      <table class="mb-0 table table-striped table-hover" id="code-builder-table" style="width: 100%">
        <thead>
          <tr>
            <th></th>
            <th>일련번호</th>
            <th>특성</th>
            <th>종류</th>
            <th>적용방식</th>
            <th>기본값</th>
            <th>변경값</th>
            <th></th>
          </tr>
        </thead>

      </table>
    </div>
  </div>
{% endblock page-content %}

{% block js %}
  <script type="text/javascript" src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/datatables.min.js' %}"></script>
  <script type="text/javascript">
    var table = $('#code-builder-table').DataTable({
      stateSave: true,
      "processing": true,
      "ajax": {
        "processing": true,
        "url": "{% url 'code-builder-json' %}",
        "dataSrc": "",
      },
      "columns": [
        {
          data: null,
          defaultContent: '<i class="pe-7s-angle-left increase-arrow" name="down-button"></i>',
          orderable: false,
          searchable: false
        },
        {data: 'pk'},
        {data: 'fields.description_ko'},
        {data: 'fields.modifier_type'},
        {data: 'fields.effect_type'},
        {data: 'fields.default_value'},
        {data: 'fields.current_value'},
        {
          data: null,
          defaultContent: '<i class="pe-7s-angle-right increase-arrow" name="up-button"></i>',
          orderable: false,
          searchable: false
        }
      ]
    });

    $('#code-builder-table tbody').on('click', 'i[name="down-button"]', function () {
        var data = table.row( $(this).parents('tr') ).data();
        var dataString = 'subno=' + data.pk;
        console.log(dataString);
      $.ajax({
        type: "POST",
        url: "{% url 'decrease-value' %}",
        data: dataString,
        success: function() {
          table.ajax.reload( null, false );
        }
      });
    });

    $('#code-builder-table tbody').on('click', 'i[name="up-button"]', function () {
        var data = table.row( $(this).parents('tr') ).data();
        var dataString = 'subno=' + data.pk;
        console.log(dataString);
      $.ajax({
        type: "POST",
        url: "{% url 'increase-value' %}",
        data: dataString,
        success: function() {
          table.ajax.reload( null, false );
        }
      });
    });
  </script>
  <script>
    function CopyToClipboard(containerid) {
      if (document.selection) {
        var range = document.body.createTextRange();
        range.moveToElementText(document.getElementById(containerid));
        range.select().createTextRange();
        document.execCommand("copy");

      } else if (window.getSelection) {
        var range = document.createRange();
         range.selectNode(document.getElementById(containerid));
         window.getSelection().addRange(range);
         document.execCommand("copy");
         window.getSelection().removeAllRanges();
      }}
  </script>
{% endblock js %}
